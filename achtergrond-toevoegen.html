<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achtergrond Toevoegen aan Afbeelding</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Popup styling */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .popup-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 25px;
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4b6cb7;
        }
        
        .popup-title {
            font-size: 1.8rem;
            color: #182848;
            margin: 0;
        }
        
        .close-popup {
            background: none;
            border: none;
            font-size: 2rem;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .close-popup:hover {
            background-color: #f0f0f0;
            color: #182848;
        }
        
        .positioning-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .positioning-canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            border: 2px solid #e0e5f0;
            border-radius: 10px;
            overflow: hidden;
            background-color: #f8f9ff;
        }
        
        #positionCanvas {
            width: 100%;
            height: 100%;
            display: block;
            cursor: move;
        }
        
        .position-controls {
            background-color: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn {
            background-color: #4b6cb7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-btn:hover {
            background-color: #3a5aa3;
            transform: translateY(-2px);
        }
        
        .control-btn.reset {
            background-color: #e74c3c;
        }
        
        .control-btn.reset:hover {
            background-color: #c0392b;
        }
        
        .control-btn.download {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            padding: 12px 30px;
            font-size: 1.1rem;
        }
        
        .control-btn.download:hover {
            background: linear-gradient(to right, #27ae60, #219653);
        }
        
        .slider-control {
            flex: 1;
            min-width: 200px;
        }
        
        .slider-control label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #182848;
        }
        
        .slider-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .size-value {
            min-width: 60px;
            font-weight: 600;
            color: #182848;
        }
        
        .instructions-popup {
            background-color: #e8f4ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4b6cb7;
            margin-top: 10px;
        }
        
        .instructions-popup h4 {
            color: #182848;
            margin-bottom: 8px;
        }
        
        .instructions-popup p {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .position-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .slider-control {
                min-width: 100%;
            }
            
            .popup-content {
                padding: 15px;
            }
            
            .positioning-canvas-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Achtergrond Toevoegen aan Afbeelding</h1>
            <p class="subtitle">Upload een afbeelding zonder achtergrond en een achtergrondafbeelding - positioneer en download het resultaat</p>
        </header>
        
        <div class="main-content">
            <div class="upload-section">
                <div class="upload-box" id="foregroundBox">
                    <h3>Voorgrondafbeelding</h3>
                    <p>Upload een afbeelding zonder achtergrond (PNG met transparantie werkt het beste)</p>
                    <div class="image-preview" id="foregroundPreview">
                        <span>Nog niet ge√ºpload</span>
                    </div>
                    <button class="upload-btn" id="foregroundBtn">Kies Voorgrond</button>
                    <input type="file" id="foregroundInput" class="file-input" accept="image/png, image/jpeg">
                    <div class="upload-status" id="foregroundStatus"></div>
                </div>
                
                <div class="upload-box" id="backgroundBox">
                    <h3>Achtergrondafbeelding</h3>
                    <p>Upload de achtergrond die je wilt toevoegen</p>
                    <div class="image-preview" id="backgroundPreview">
                        <span>Nog niet ge√ºpload</span>
                    </div>
                    <button class="upload-btn" id="backgroundBtn">Kies Achtergrond</button>
                    <input type="file" id="backgroundInput" class="file-input" accept="image/png, image/jpeg, image/jpg">
                    <div class="upload-status" id="backgroundStatus"></div>
                </div>
            </div>
            
            <div class="loader" id="combineLoader"></div>
            
            <div class="result-section">
                <h2 class="section-title">Voorbeeld van het resultaat</h2>
                <div class="result-container">
                    <canvas id="resultCanvas"></canvas>
                </div>
                
                <div class="download-info" id="downloadInfo" style="display: none;">
                    <h4>‚úÖ Afbeelding klaar voor positionering!</h4>
                    <p>Beide afbeeldingen zijn ge√ºpload. Klik op de knop hieronder om de voorgrond te positioneren.</p>
                    <div class="manual-download">
                        <button class="button download-btn" id="positionBtn">Positioneer & Download</button>
                    </div>
                </div>
                
                <div class="automatic-notice" id="readyNotice" style="display: none;">
                    ‚úÖ Beide afbeeldingen zijn ge√ºpload! Klik op "Positioneer & Download" om het resultaat aan te passen en te downloaden.
                </div>
            </div>
            
            <div class="info-box">
                <div class="info-title">Hoe werkt het?</div>
                <div class="info-text">
                    <ol style="padding-left: 20px;">
                        <li><strong>Upload een voorgrondafbeelding</strong> zonder achtergrond (PNG met transparantie werkt het beste).</li>
                        <li><strong>Upload een achtergrondafbeelding</strong> waar je achter de voorgrondafbeelding wilt plaatsen.</li>
                        <li><strong>Positioneer:</strong> Klik op "Positioneer & Download" om de voorgrond te verplaatsen en groter/kleiner te maken.</li>
                        <li><strong>Download:</strong> Pas de voorgrond aan zoals je wilt en klik op "Klaar & Download" om het resultaat op te slaan.</li>
                    </ol>
                    <p style="margin-top: 15px;"><strong>Tip:</strong> In de popup kun je de voorgrondafbeelding slepen om te verplaatsen en de grootte aanpassen met de schuifregelaar.</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p><a href="index.html" style="color: #4b6cb7; text-decoration: none;">‚Üê Terug naar startpagina</a> | Achtergrond Toevoegen &copy; 2023 | Werkt volledig in je browser</p>
        </footer>
    </div>
    
    <!-- Popup voor positionering -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-content">
            <div class="popup-header">
                <h2 class="popup-title">Positioneer Voorgrondafbeelding</h2>
                <button class="close-popup" id="closePopup">√ó</button>
            </div>
            
            <div class="positioning-container">
                <div class="instructions-popup">
                    <h4>Instructies:</h4>
                    <p>‚Ä¢ <strong>Slepen:</strong> Klik en sleep om de voorgrondafbeelding te verplaatsen</p>
                    <p>‚Ä¢ <strong>Grootte:</strong> Gebruik de schuifregelaar om de voorgrond groter of kleiner te maken</p>
                    <p>‚Ä¢ <strong>Reset:</strong> Klik op "Reset Positie" om terug te gaan naar de beginpositie</p>
                </div>
                
                <div class="positioning-canvas-container">
                    <canvas id="positionCanvas"></canvas>
                </div>
                
                <div class="position-controls">
                    <div class="slider-control">
                        <label for="sizeSlider">Voorgrond Grootte</label>
                        <div class="slider-row">
                            <input type="range" min="10" max="200" value="80" class="slider" id="sizeSlider">
                            <span class="size-value" id="sizeValue">80%</span>
                        </div>
                    </div>
                    
                    <button class="control-btn" id="centerBtn">
                        <span>üî≤</span> Centreer
                    </button>
                    
                    <button class="control-btn reset" id="resetBtn">
                        <span>üîÑ</span> Reset Positie
                    </button>
                    
                    <button class="control-btn download" id="finalDownloadBtn">
                        <span>‚¨áÔ∏è</span> Klaar & Download
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM elementen
        const foregroundInput = document.getElementById('foregroundInput');
        const backgroundInput = document.getElementById('backgroundInput');
        const foregroundBtn = document.getElementById('foregroundBtn');
        const backgroundBtn = document.getElementById('backgroundBtn');
        const foregroundPreview = document.getElementById('foregroundPreview');
        const backgroundPreview = document.getElementById('backgroundPreview');
        const foregroundStatus = document.getElementById('foregroundStatus');
        const backgroundStatus = document.getElementById('backgroundStatus');
        const foregroundBox = document.getElementById('foregroundBox');
        const backgroundBox = document.getElementById('backgroundBox');
        const resultCanvas = document.getElementById('resultCanvas');
        const combineLoader = document.getElementById('combineLoader');
        const downloadInfo = document.getElementById('downloadInfo');
        const positionBtn = document.getElementById('positionBtn');
        const readyNotice = document.getElementById('readyNotice');
        const popupOverlay = document.getElementById('popupOverlay');
        const closePopup = document.getElementById('closePopup');
        const positionCanvas = document.getElementById('positionCanvas');
        const sizeSlider = document.getElementById('sizeSlider');
        const sizeValue = document.getElementById('sizeValue');
        const centerBtn = document.getElementById('centerBtn');
        const resetBtn = document.getElementById('resetBtn');
        const finalDownloadBtn = document.getElementById('finalDownloadBtn');
        
        const ctx = resultCanvas.getContext('2d');
        const positionCtx = positionCanvas.getContext('2d');
        
        // Variabelen om afbeeldingen op te slaan
        let foregroundImage = null;
        let backgroundImage = null;
        let combineInProgress = false;
        let isExampleImage = true;
        
        // Variabelen voor positionering
        let foregroundX = 0;
        let foregroundY = 0;
        let foregroundScale = 0.8;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let originalForegroundX = 0;
        let originalForegroundY = 0;
        let canvasWidth = 0;
        let canvasHeight = 0;
        
        // Stel canvasgrootte in
        function setupCanvas() {
            resultCanvas.width = 600;
            resultCanvas.height = 400;
            
            // Teken een standaard achtergrondpatroon
            ctx.fillStyle = '#f5f5f5';
            ctx.fillRect(0, 0, resultCanvas.width, resultCanvas.height);
            
            // Teken een rasterpatroon
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            // Verticale lijnen
            for (let x = 0; x <= resultCanvas.width; x += 20) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, resultCanvas.height);
                ctx.stroke();
            }
            
            // Horizontale lijnen
            for (let y = 0; y <= resultCanvas.height; y += 20) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(resultCanvas.width, y);
                ctx.stroke();
            }
            
            // Voeg tekst toe
            ctx.fillStyle = '#999';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Upload beide afbeeldingen om te beginnen', resultCanvas.width/2, resultCanvas.height/2);
        }
        
        // Initialiseer canvas
        setupCanvas();
        
        // Event listeners voor knoppen
        foregroundBtn.addEventListener('click', () => {
            foregroundInput.click();
        });
        
        backgroundBtn.addEventListener('click', () => {
            backgroundInput.click();
        });
        
        // Event listener voor voorgrondafbeelding
        foregroundInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Markeer dat dit geen voorbeeldafbeelding is
            isExampleImage = false;
            
            // Toon uploadstatus
            foregroundStatus.textContent = "Bezig met uploaden...";
            foregroundStatus.className = "upload-status status-waiting";
            foregroundBox.classList.add('active');
            
            const reader = new FileReader();
            reader.onload = function(event) {
                foregroundImage = new Image();
                foregroundImage.onload = function() {
                    // Toon voorbeeld
                    foregroundPreview.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    foregroundPreview.appendChild(img);
                    
                    // Update status
                    foregroundStatus.textContent = "‚úÖ Klaar!";
                    foregroundStatus.className = "upload-status status-success";
                    
                    // Controleer of beide afbeeldingen geladen zijn
                    checkAndCombineImages();
                };
                foregroundImage.onerror = function() {
                    foregroundStatus.textContent = "‚ùå Fout bij laden afbeelding";
                    foregroundStatus.className = "upload-status";
                    foregroundImage = null;
                };
                foregroundImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
        
        // Event listener voor achtergrondafbeelding
        backgroundInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Markeer dat dit geen voorbeeldafbeelding is
            isExampleImage = false;
            
            // Toon uploadstatus
            backgroundStatus.textContent = "Bezig met uploaden...";
            backgroundStatus.className = "upload-status status-waiting";
            backgroundBox.classList.add('active');
            
            const reader = new FileReader();
            reader.onload = function(event) {
                backgroundImage = new Image();
                backgroundImage.onload = function() {
                    // Toon voorbeeld
                    backgroundPreview.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    backgroundPreview.appendChild(img);
                    
                    // Update status
                    backgroundStatus.textContent = "‚úÖ Klaar!";
                    backgroundStatus.className = "upload-status status-success";
                    
                    // Controleer of beide afbeeldingen geladen zijn
                    checkAndCombineImages();
                };
                backgroundImage.onerror = function() {
                    backgroundStatus.textContent = "‚ùå Fout bij laden afbeelding";
                    backgroundStatus.className = "upload-status";
                    backgroundImage = null;
                };
                backgroundImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
        
        // Controleer of beide afbeeldingen geladen zijn en combineer ze
        function checkAndCombineImages() {
            if (foregroundImage && backgroundImage && !combineInProgress) {
                combineInProgress = true;
                combineLoader.classList.add('show');
                
                // Korte vertraging om gebruiker te laten zien wat er gebeurt
                setTimeout(() => {
                    combineImages();
                    combineInProgress = false;
                    combineLoader.classList.remove('show');
                    
                    // Toon positioneer knop alleen als het GEEN voorbeeldafbeelding is
                    if (!isExampleImage) {
                        downloadInfo.style.display = 'block';
                        readyNotice.style.display = 'block';
                    } else {
                        // Voor voorbeeldafbeeldingen, toon alleen de melding
                        readyNotice.style.display = 'block';
                        readyNotice.innerHTML = "‚úÖ Voorbeeld geladen! Upload nu je eigen afbeeldingen om te kunnen positioneren en downloaden.";
                        readyNotice.style.backgroundColor = "rgba(255, 193, 7, 0.1)";
                        readyNotice.style.border = "1px solid #ffc107";
                        readyNotice.style.color = "#856404";
                    }
                }, 800);
            }
        }
        
        // Combineer de afbeeldingen (toon alleen voorbeeld)
        function combineImages() {
            if (!foregroundImage || !backgroundImage) return;
            
            // Bereken de schaal voor de voorgrondafbeelding
            // We willen dat de voorgrondafbeelding goed past in het canvas
            foregroundScale = Math.min(
                resultCanvas.width / foregroundImage.width * 0.8,
                resultCanvas.height / foregroundImage.height * 0.8
            );
            
            const newWidth = foregroundImage.width * foregroundScale;
            const newHeight = foregroundImage.height * foregroundScale;
            
            // Centreer de voorgrondafbeelding
            foregroundX = (resultCanvas.width - newWidth) / 2;
            foregroundY = (resultCanvas.height - newHeight) / 2;
            
            // Teken op het resultaat canvas
            drawCombinedImage(resultCanvas, ctx);
        }
        
        // Teken gecombineerde afbeelding op een canvas
        function drawCombinedImage(canvas, context) {
            if (!foregroundImage || !backgroundImage) return;
            
            // Pas canvasgrootte aan aan de achtergrondafbeelding
            canvas.width = backgroundImage.width;
            canvas.height = backgroundImage.height;
            
            // Teken de achtergrond
            context.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            
            // Bereken nieuwe grootte op basis van schaal
            const newWidth = foregroundImage.width * foregroundScale;
            const newHeight = foregroundImage.height * foregroundScale;
            
            // Teken de voorgrondafbeelding
            context.drawImage(foregroundImage, foregroundX, foregroundY, newWidth, newHeight);
        }
        
        // Event listener voor positioneer knop
        positionBtn.addEventListener('click', () => {
            if (!foregroundImage || !backgroundImage || isExampleImage) {
                showStatusMessage("Upload eerst je eigen afbeeldingen om te kunnen positioneren", true);
                return;
            }
            
            openPositioningPopup();
        });
        
        // Open popup voor positionering
        function openPositioningPopup() {
            // Stel canvasgrootte in
            canvasWidth = backgroundImage.width;
            canvasHeight = backgroundImage.height;
            
            // Pas position canvas aan aan popup grootte
            const containerWidth = document.querySelector('.positioning-canvas-container').clientWidth;
            const containerHeight = document.querySelector('.positioning-canvas-container').clientHeight;
            
            // Bereken schaal om canvas in container te passen
            const scaleX = containerWidth / canvasWidth;
            const scaleY = containerHeight / canvasHeight;
            const scale = Math.min(scaleX, scaleY, 1);
            
            positionCanvas.width = canvasWidth * scale;
            positionCanvas.height = canvasHeight * scale;
            
            // Schaal ook de voorgrond positie
            const scaledForegroundX = foregroundX * scale;
            const scaledForegroundY = foregroundY * scale;
            const scaledForegroundScale = foregroundScale * scale;
            
            // Teken afbeelding op position canvas
            positionCtx.clearRect(0, 0, positionCanvas.width, positionCanvas.height);
            positionCtx.drawImage(backgroundImage, 0, 0, positionCanvas.width, positionCanvas.height);
            
            // Teken voorgrond
            const newWidth = foregroundImage.width * scaledForegroundScale;
            const newHeight = foregroundImage.height * scaledForegroundScale;
            positionCtx.drawImage(foregroundImage, scaledForegroundX, scaledForegroundY, newWidth, newHeight);
            
            // Stel slider in
            sizeSlider.value = foregroundScale * 100;
            sizeValue.textContent = Math.round(foregroundScale * 100) + "%";
            
            // Toon popup
            popupOverlay.style.display = 'flex';
            
            // Voeg event listeners toe voor slepen
            setupDragging();
        }
        
        // Sluit popup
        closePopup.addEventListener('click', () => {
            popupOverlay.style.display = 'none';
        });
        
        // Sluit popup als er buiten geklikt wordt
        popupOverlay.addEventListener('click', (e) => {
            if (e.target === popupOverlay) {
                popupOverlay.style.display = 'none';
            }
        });
        
        // Stel slepen functionaliteit in
        function setupDragging() {
            positionCanvas.addEventListener('mousedown', startDragging);
            positionCanvas.addEventListener('touchstart', startDraggingTouch);
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', dragTouch);
            
            document.addEventListener('mouseup', stopDragging);
            document.addEventListener('touchend', stopDragging);
        }
        
        // Start slepen (muis)
        function startDragging(e) {
            const rect = positionCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Controleer of er op de voorgrondafbeelding wordt geklikt
            const scaleFactor = positionCanvas.width / canvasWidth;
            const scaledForegroundWidth = foregroundImage.width * foregroundScale * scaleFactor;
            const scaledForegroundHeight = foregroundImage.height * foregroundScale * scaleFactor;
            const scaledForegroundX = foregroundX * scaleFactor;
            const scaledForegroundY = foregroundY * scaleFactor;
            
            if (x >= scaledForegroundX && x <= scaledForegroundX + scaledForegroundWidth &&
                y >= scaledForegroundY && y <= scaledForegroundY + scaledForegroundHeight) {
                isDragging = true;
                dragStartX = x;
                dragStartY = y;
                originalForegroundX = foregroundX;
                originalForegroundY = foregroundY;
                positionCanvas.style.cursor = 'grabbing';
            }
        }
        
        // Start slepen (touch)
        function startDraggingTouch(e) {
            if (e.touches.length === 1) {
                const rect = positionCanvas.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                
                // Controleer of er op de voorgrondafbeelding wordt geklikt
                const scaleFactor = positionCanvas.width / canvasWidth;
                const scaledForegroundWidth = foregroundImage.width * foregroundScale * scaleFactor;
                const scaledForegroundHeight = foregroundImage.height * foregroundScale * scaleFactor;
                const scaledForegroundX = foregroundX * scaleFactor;
                const scaledForegroundY = foregroundY * scaleFactor;
                
                if (x >= scaledForegroundX && x <= scaledForegroundX + scaledForegroundWidth &&
                    y >= scaledForegroundY && y <= scaledForegroundY + scaledForegroundHeight) {
                    e.preventDefault();
                    isDragging = true;
                    dragStartX = x;
                    dragStartY = y;
                    originalForegroundX = foregroundX;
                    originalForegroundY = foregroundY;
                    positionCanvas.style.cursor = 'grabbing';
                }
            }
        }
        
        // Slepen (muis)
        function drag(e) {
            if (!isDragging) return;
            
            const rect = positionCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const scaleFactor = canvasWidth / positionCanvas.width;
            const dx = (x - dragStartX) * scaleFactor;
            const dy = (y - dragStartY) * scaleFactor;
            
            foregroundX = originalForegroundX + dx;
            foregroundY = originalForegroundY + dy;
            
            updatePositionCanvas();
        }
        
        // Slepen (touch)
        function dragTouch(e) {
            if (!isDragging || e.touches.length !== 1) return;
            
            e.preventDefault();
            const rect = positionCanvas.getBoundingClientRect();
            const x = e.touches[0].clientX - rect.left;
            const y = e.touches[0].clientY - rect.top;
            
            const scaleFactor = canvasWidth / positionCanvas.width;
            const dx = (x - dragStartX) * scaleFactor;
            const dy = (y - dragStartY) * scaleFactor;
            
            foregroundX = originalForegroundX + dx;
            foregroundY = originalForegroundY + dy;
            
            updatePositionCanvas();
        }
        
        // Stop slepen
        function stopDragging() {
            isDragging = false;
            positionCanvas.style.cursor = 'move';
        }
        
        // Update position canvas
        function updatePositionCanvas() {
            // Teken opnieuw
            const scale = positionCanvas.width / canvasWidth;
            
            positionCtx.clearRect(0, 0, positionCanvas.width, positionCanvas.height);
            positionCtx.drawImage(backgroundImage, 0, 0, positionCanvas.width, positionCanvas.height);
            
            const scaledForegroundWidth = foregroundImage.width * foregroundScale * scale;
            const scaledForegroundHeight = foregroundImage.height * foregroundScale * scale;
            const scaledForegroundX = foregroundX * scale;
            const scaledForegroundY = foregroundY * scale;
            
            positionCtx.drawImage(foregroundImage, scaledForegroundX, scaledForegroundY, scaledForegroundWidth, scaledForegroundHeight);
            
            // Update ook het voorbeeld op de hoofdpagina
            drawCombinedImage(resultCanvas, ctx);
        }
        
        // Event listener voor grootte slider
        sizeSlider.addEventListener('input', () => {
            foregroundScale = sizeSlider.value / 100;
            sizeValue.textContent = sizeSlider.value + "%";
            updatePositionCanvas();
        });
        
        // Event listener voor centreer knop
        centerBtn.addEventListener('click', () => {
            // Bereken nieuwe grootte
            const newWidth = foregroundImage.width * foregroundScale;
            const newHeight = foregroundImage.height * foregroundScale;
            
            // Centreer
            foregroundX = (canvasWidth - newWidth) / 2;
            foregroundY = (canvasHeight - newHeight) / 2;
            
            updatePositionCanvas();
            showStatusMessage("Voorgrond gecentreerd");
        });
        
        // Event listener voor reset knop
        resetBtn.addEventListener('click', () => {
            // Reset naar oorspronkelijke positie en grootte
            foregroundScale = Math.min(
                canvasWidth / foregroundImage.width * 0.8,
                canvasHeight / foregroundImage.height * 0.8
            );
            
            const newWidth = foregroundImage.width * foregroundScale;
            const newHeight = foregroundImage.height * foregroundScale;
            
            foregroundX = (canvasWidth - newWidth) / 2;
            foregroundY = (canvasHeight - newHeight) / 2;
            
            sizeSlider.value = foregroundScale * 100;
            sizeValue.textContent = Math.round(foregroundScale * 100) + "%";
            
            updatePositionCanvas();
            showStatusMessage("Positie gereset");
        });
        
        // Event listener voor download knop in popup
        finalDownloadBtn.addEventListener('click', () => {
            // Download de afbeelding
            downloadImage();
            
            // Sluit popup
            popupOverlay.style.display = 'none';
        });
        
        // Download de gecombineerde afbeelding
        function downloadImage() {
            if (!foregroundImage || !backgroundImage) return;
            
            // Maak een tijdelijk canvas voor download
            const downloadCanvas = document.createElement('canvas');
            const downloadCtx = downloadCanvas.getContext('2d');
            
            // Stel canvasgrootte in op achtergrondgrootte
            downloadCanvas.width = canvasWidth;
            downloadCanvas.height = canvasHeight;
            
            // Teken de gecombineerde afbeelding
            downloadCtx.drawImage(backgroundImage, 0, 0, downloadCanvas.width, downloadCanvas.height);
            
            const newWidth = foregroundImage.width * foregroundScale;
            const newHeight = foregroundImage.height * foregroundScale;
            
            downloadCtx.drawImage(foregroundImage, foregroundX, foregroundY, newWidth, newHeight);
            
            // Maak een tijdelijk linkelement
            const link = document.createElement('a');
            link.download = `achtergrond-toegevoegd-${new Date().getTime()}.png`;
            link.href = downloadCanvas.toDataURL('image/png');
            
            // Simuleer een klik op de link om download te starten
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Toon downloadbevestiging
            showStatusMessage("Afbeelding gedownload!", false, "#2ecc71");
        }
        
        // Toon statusbericht
        function showStatusMessage(message, isError = false, bgColor = null) {
            // Verwijder bestaande statusberichten
            const existingMessages = document.querySelectorAll('.status-message');
            existingMessages.forEach(msg => msg.remove());
            
            // Maak nieuw statusbericht
            const statusMessage = document.createElement('div');
            statusMessage.className = 'status-message';
            statusMessage.textContent = message;
            
            if (bgColor) {
                statusMessage.style.backgroundColor = bgColor;
            } else if (isError) {
                statusMessage.style.backgroundColor = '#e74c3c';
            }
            
            document.body.appendChild(statusMessage);
            
            // Verberg na 3 seconden
            setTimeout(() => {
                statusMessage.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => statusMessage.remove(), 300);
            }, 3000);
        }
        
        // Voeg een voorbeeldafbeeldingen toe voor demonstratie
        window.addEventListener('load', function() {
            // Voorbeeldafbeeldingen
            const exampleForeground = new Image();
            exampleForeground.onload = function() {
                // Toon voorbeeld in de preview
                foregroundPreview.innerHTML = '';
                const img = document.createElement('img');
                img.src = exampleForeground.src;
                foregroundPreview.appendChild(img);
                foregroundImage = exampleForeground;
                
                // Update status
                foregroundStatus.textContent = "Voorbeeld geladen";
                foregroundStatus.className = "upload-status";
                foregroundBox.classList.add('active');
                
                // Controleer of beide afbeeldingen geladen zijn
                checkAndCombineImages();
            };
            // Een eenvoudige ster als voorbeeldvoorgrond
            exampleForeground.src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSJ1cmwoI2dyYWRpZW50MCkiLz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQwIiB4MT0iMTAwIiB5MT0iMCIgeDI9IjEwMCIgeTI9IjIwMCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNmZmZmZmYiIHN0b3Atb3BhY2l0eT0iMCIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmZmZmZmYiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8cGF0aCBkPSJNMTUwIDc1TDEwMCAxMEw1MCA3NUw1IDg1TDU1IDE0MEw1MCAyMTBMMTAwIDE3NUwxNTAgMjEwTDE0NSAxNDBMMTk1IDg1TDE1MCA3NVoiIGZpbGw9IiMxODI4NDgiLz4KPC9zdmc+Cg==";
            
            // Voorbeeldachtergrond
            const exampleBackground = new Image();
            exampleBackground.onload = function() {
                // Toon voorbeeld in de preview
                backgroundPreview.innerHTML = '';
                const img = document.createElement('img');
                img.src = exampleBackground.src;
                backgroundPreview.appendChild(img);
                backgroundImage = exampleBackground;
                
                // Update status
                backgroundStatus.textContent = "Voorbeeld geladen";
                backgroundStatus.className = "upload-status";
                backgroundBox.classList.add('active');
                
                // Controleer of beide afbeeldingen geladen zijn
                checkAndCombineImages();
            };
            // Een eenvoudige gradient achtergrond als voorbeeld
            exampleBackground.src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDYwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iNDAwIiBmaWxsPSJ1cmwoI2dyYWRpZW50KSIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJncmFkaWVudCIgeDE9IjAiIHkxPSIwIiB4Mj0iNjAwIiB5Mj0iNDAwIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iIzI1NzVmYyIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM2YTExY2IiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K";
            
            // Toon welkomstbericht
            setTimeout(() => {
                showStatusMessage("Voorbeeld geladen! Upload je eigen afbeeldingen om te beginnen");
            }, 1000);
        });
    </script>
</body>
</html>
